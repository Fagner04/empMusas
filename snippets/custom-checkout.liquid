<!-- Checkout Customizado - Redirecionamento -->
<script>
(function() {
  // Configurações - EDITE AQUI
  var CHECKOUT_URL = "https://conectwhats.vercel.app/c/musasclub";
  var SKIP_CART = true; // true = redireciona direto | false = passa pelo carrinho primeiro
  
  // Função para redirecionar com itens do carrinho
  function redirectWithCart() {
    fetch('/cart.js')
      .then(function(r) { return r.json(); })
      .then(function(cart) {
        if (cart.items && cart.items.length > 0) {
          var items = encodeURIComponent(JSON.stringify(cart.items.map(function(item) {
            return { id: item.variant_id, qty: item.quantity, name: item.title, price: item.price / 100, img: item.image };
          })));
          window.location.href = CHECKOUT_URL + "?items=" + items;
        } else {
          window.location.href = CHECKOUT_URL;
        }
      })
      .catch(function() {
        window.location.href = CHECKOUT_URL;
      });
  }
  
  // Interceptar formulário de add to cart
  document.addEventListener('submit', function(e) {
    var form = e.target;
    if (form.action && form.action.includes('/cart')) {
      if (SKIP_CART) {
        e.preventDefault();
        
        // Pegar ID do produto do formulário
        var productInput = form.querySelector('[name="id"]');
        var quantityInput = form.querySelector('[name="quantity"]');
        
        if (productInput) {
          var productId = productInput.value;
          var quantity = quantityInput ? quantityInput.value : 1;
          
          // Redirecionar direto para checkout customizado
          window.location.href = CHECKOUT_URL + "/" + productId + "?quantity=" + quantity;
        }
      }
      // Se SKIP_CART = false, deixa o carrinho Shopify funcionar normalmente
    }
  }, true);
  
  // Interceptar clique em botões de checkout (seletores ampliados para mais temas)
  document.addEventListener('click', function(e) {
    var checkoutSelectors = [
      '[name="checkout"]',
      '[type="submit"][name="checkout"]',
      '.shopify-payment-button',
      '[data-checkout-url]',
      'button[name="checkout"]',
      'input[name="checkout"]',
      '.cart__checkout-button',
      '.cart-checkout-button',
      '[href*="/checkout"]',
      '.checkout-button',
      '#checkout',
      '[data-action="checkout"]'
    ].join(', ');
    
    var target = e.target.closest(checkoutSelectors);
    if (target) {
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();
      redirectWithCart();
      return false;
    }
  }, true); // Use capture phase para pegar o evento antes de outros handlers
  
  // Interceptar navegação para /checkout (fallback)
  var originalPushState = history.pushState;
  history.pushState = function() {
    originalPushState.apply(history, arguments);
    if (window.location.pathname.includes('/checkout')) {
      redirectWithCart();
    }
  };
  
  // Verificar se já estamos no checkout
  if (window.location.pathname.includes('/checkout')) {
    redirectWithCart();
  }
})();
</script>