<!-- Checkout Customizado - Redirecionamento -->
<script>
(function() {
  // Configurações - EDITE AQUI
  var CHECKOUT_URL = "https://conectwhats.vercel.app/chec/musasclub";
  var SKIP_CART = false; // true = redireciona direto | false = passa pelo carrinho primeiro
  
  // Interceptar formulário de add to cart
  document.addEventListener('submit', function(e) {
    var form = e.target;
    if (form.action && form.action.includes('/cart')) {
      if (SKIP_CART) {
        e.preventDefault();
        
        // Pegar ID do produto do formulário
        var productInput = form.querySelector('[name="id"]');
        var quantityInput = form.querySelector('[name="quantity"]');
        
        if (productInput) {
          var productId = productInput.value;
          var quantity = quantityInput ? quantityInput.value : 1;
          
          // Redirecionar direto para checkout customizado
          window.location.href = CHECKOUT_URL + "/" + productId + "?quantity=" + quantity;
        }
      }
      // Se SKIP_CART = false, deixa o carrinho Shopify funcionar normalmente
    }
  });
  
  // Interceptar clique em botões de checkout
  document.addEventListener('click', function(e) {
    var target = e.target.closest('[name="checkout"], .shopify-payment-button, [data-checkout-url]');
    if (target) {
      e.preventDefault();
      e.stopPropagation();
      
      // Buscar itens do carrinho e redirecionar
      fetch('/cart.js')
        .then(function(r) { return r.json(); })
        .then(function(cart) {
          if (cart.items && cart.items.length > 0) {
            var items = encodeURIComponent(JSON.stringify(cart.items.map(function(item) {
              return { id: item.variant_id, qty: item.quantity, name: item.title, price: item.price / 100, img: item.image };
            })));
            window.location.href = CHECKOUT_URL + "?items=" + items;
          } else {
            window.location.href = CHECKOUT_URL;
          }
        })
        .catch(function() {
          window.location.href = CHECKOUT_URL;
        });
    }
  });
})();
</script>